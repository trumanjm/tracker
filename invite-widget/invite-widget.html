<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Invite Progress Widget</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;800&display=swap" rel="stylesheet">
<style>
	:root {
		--bg: #f8fafc;
		--card: #ffffff;
		--text: #0f172a;
		--muted: #64748b;
		--track: #e2e8f0;
		--fill: #7dd3fc;
		--fill-boost: linear-gradient(90deg, #22d3ee, #34d399, #fbbf24);
		--checkpoint-locked: #cbd5e1;
		--checkpoint-unlocked: #22c55e;
		--checkpoint-close: #f59e0b;
	}
	* { box-sizing: border-box; }
	body {
		margin: 0;
		padding: 24px;
		background: radial-gradient(1200px 600px at 10% -10%, #eef7ff 10%, transparent 40%),
		            radial-gradient(900px 500px at 110% 10%, #fff4ed 10%, transparent 45%),
		            var(--bg);
		color: var(--text);
		font-family: 'Nunito', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
		min-height: 100vh;
		display: flex;
		align-items: center;
		justify-content: center;
	}
	.widget {
		max-width: 680px;
		width: 100%;
		background: var(--card);
		border-radius: 20px;
		box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
		padding: 32px;
	}
	.header {
		display: flex;
		align-items: center;
		justify-content: space-between;
		gap: 16px;
		flex-wrap: wrap;
		margin-bottom: 24px;
	}
	.header h1 {
		margin: 0;
		font-size: 18px;
		color: var(--muted);
		font-weight: 700;
		letter-spacing: 0.2px;
	}
	.input-section {
		display: flex;
		flex-direction: column;
		gap: 12px;
		margin-bottom: 24px;
	}
	.input-row {
		display: flex;
		gap: 12px;
		align-items: flex-end;
	}
	.input-wrap {
		flex: 1;
		display: flex;
		flex-direction: column;
		gap: 8px;
	}
	.input-wrap label {
		font-size: 14px;
		color: var(--muted);
		font-weight: 700;
	}
	#inviteInput {
		appearance: textfield;
		width: 100%;
		font-size: 44px;
		font-weight: 800;
		padding: 10px 16px;
		border-radius: 14px;
		border: 2px solid #e5e7eb;
		background: #fff;
		color: var(--text);
		letter-spacing: 0.5px;
		outline: none;
		transition: border-color 160ms ease, box-shadow 160ms ease;
	}
	#inviteInput:focus {
		border-color: #22d3ee;
		box-shadow: 0 0 0 6px rgba(34, 211, 238, 0.15);
	}
	#nameInput {
		width: 100%;
		font-size: 16px;
		font-weight: 700;
		padding: 10px 16px;
		border-radius: 14px;
		border: 2px solid #e5e7eb;
		background: #fff;
		color: var(--text);
		outline: none;
		transition: border-color 160ms ease, box-shadow 160ms ease;
	}
	#nameInput:focus {
		border-color: #22d3ee;
		box-shadow: 0 0 0 6px rgba(34, 211, 238, 0.15);
	}
	.submit-btn {
		padding: 14px 28px;
		font-size: 16px;
		font-weight: 800;
		color: white;
		background: linear-gradient(135deg, #22d3ee, #0ea5e9);
		border: none;
		border-radius: 14px;
		cursor: pointer;
		transition: transform 150ms ease, box-shadow 150ms ease;
		box-shadow: 0 4px 12px rgba(34, 211, 238, 0.3);
		font-family: 'Nunito', system-ui, sans-serif;
		white-space: nowrap;
	}
	.submit-btn:hover {
		transform: translateY(-2px);
		box-shadow: 0 6px 20px rgba(34, 211, 238, 0.4);
	}
	.submit-btn:active {
		transform: translateY(0);
	}
	.submit-btn:disabled {
		opacity: 0.6;
		cursor: not-allowed;
		transform: none;
	}
	.submit-success {
		animation: successPulse 0.5s ease;
	}
	@keyframes successPulse {
		0%, 100% { transform: scale(1); }
		50% { transform: scale(1.05); }
	}
	.history-section {
		margin-top: 32px;
		padding-top: 24px;
		border-top: 2px solid #e5e7eb;
	}
	.history-header {
		display: flex;
		align-items: center;
		justify-content: space-between;
		margin-bottom: 16px;
	}
	.history-header h2 {
		margin: 0;
		font-size: 16px;
		color: var(--text);
		font-weight: 800;
	}
	.history-actions {
		display: flex;
		gap: 8px;
	}
	.clear-history-btn,
	.export-history-btn {
		font-size: 12px;
		font-weight: 700;
		color: var(--muted);
		background: transparent;
		border: 1px solid #e5e7eb;
		padding: 6px 12px;
		border-radius: 8px;
		cursor: pointer;
		transition: all 150ms ease;
		font-family: 'Nunito', system-ui, sans-serif;
	}
	.clear-history-btn:hover {
		color: #ef4444;
		border-color: #fecaca;
		background: #fef2f2;
	}
	.export-history-btn:hover {
		color: #0ea5e9;
		border-color: #bae6fd;
		background: #e0f2fe;
	}
	.history-list {
		display: flex;
		flex-direction: column;
		gap: 10px;
		max-height: 300px;
		overflow-y: auto;
	}
	.history-item {
		display: flex;
		align-items: center;
		justify-content: space-between;
		gap: 12px;
		padding: 12px 16px;
		background: #f8fafc;
		border: 1px solid #e5e7eb;
		border-radius: 12px;
		transition: all 150ms ease;
	}
	.history-item:hover {
		background: #f1f5f9;
		border-color: #cbd5e1;
	}
	.delete-item-btn {
		flex-shrink: 0;
		width: 28px;
		height: 28px;
		border-radius: 6px;
		border: 1px solid #e5e7eb;
		background: #fff;
		color: var(--muted);
		cursor: pointer;
		display: flex;
		align-items: center;
		justify-content: center;
		font-size: 16px;
		transition: all 150ms ease;
		padding: 0;
	}
	.delete-item-btn:hover {
		background: #fef2f2;
		border-color: #fecaca;
		color: #ef4444;
		transform: scale(1.1);
	}
	.history-item-content {
		display: flex;
		flex-direction: column;
		gap: 4px;
		flex: 1;
	}
	.history-item-top {
		display: flex;
		align-items: center;
		gap: 12px;
	}
	.history-amount {
		font-size: 18px;
		font-weight: 800;
		color: var(--text);
	}
	.history-name {
		font-size: 14px;
		font-weight: 700;
		color: var(--text);
		opacity: 0.8;
	}
	.history-date {
		font-size: 12px;
		color: var(--muted);
		font-weight: 600;
	}
	.history-empty {
		text-align: center;
		padding: 32px;
		color: var(--muted);
		font-size: 14px;
	}
	.history-empty-icon {
		font-size: 32px;
		margin-bottom: 8px;
	}
	.progress-card {
		padding: 18px;
		border-radius: 16px;
		background: #f8fafc;
		border: 1px solid #e5e7eb;
	}
	.progress-bar {
		position: relative;
		height: 20px;
		border-radius: 999px;
		background: var(--track);
		overflow: visible;
	}
	.progress-fill {
		height: 100%;
		width: 0%;
		border-radius: 999px;
		background: var(--fill);
		box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.8), 0 4px 12px rgba(34, 197, 94, 0.12);
		transition: width 260ms cubic-bezier(.2,.8,.2,1), background 200ms ease;
		position: relative;
	}
	.checkpoints {
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		height: 100%;
		pointer-events: none;
	}
	.checkpoint-dot {
		position: absolute;
		top: 50%;
		transform: translateX(-50%) translateY(-50%);
		width: 16px;
		height: 16px;
		border-radius: 50%;
		background: #fff;
		border: 2px solid var(--checkpoint-locked);
		box-shadow: 0 2px 8px rgba(0,0,0,0.1);
		transition: all 300ms cubic-bezier(0.34, 1.56, 0.64, 1);
		z-index: 10;
	}
	.checkpoint-dot.achieved {
		background: var(--checkpoint-unlocked);
		border-color: var(--checkpoint-unlocked);
		box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.2), 0 4px 12px rgba(34, 197, 94, 0.3);
		animation: achievementPop 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
	}
	.checkpoint-dot.close {
		border-color: var(--checkpoint-close);
		box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.3);
	}
	@keyframes achievementPop {
		0% {
			transform: translateX(-50%) translateY(-50%) scale(1);
		}
		50% {
			transform: translateX(-50%) translateY(-50%) scale(1.4);
		}
		100% {
			transform: translateX(-50%) translateY(-50%) scale(1.2);
		}
	}
	.progress-meta {
		display: flex;
		align-items: baseline;
		justify-content: space-between;
		margin-top: 10px;
		font-weight: 700;
	}
	.progress-meta .current {
		font-size: 24px;
	}
	.progress-meta .max {
		font-size: 14px;
		color: var(--muted);
	}
	.goals-list {
		margin-top: 20px;
		display: flex;
		flex-direction: column;
		gap: 10px;
	}
	.goal-item {
		display: flex;
		align-items: center;
		gap: 12px;
		padding: 12px 16px;
		background: #fff;
		border: 2px solid #e5e7eb;
		border-radius: 12px;
		transition: all 300ms cubic-bezier(0.34, 1.56, 0.64, 1);
	}
	.goal-item.achieved {
		background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(34, 197, 94, 0.05));
		border-color: var(--checkpoint-unlocked);
		box-shadow: 0 4px 12px rgba(34, 197, 94, 0.15);
		animation: goalAchieved 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
	}
	.goal-item.close {
		border-color: var(--checkpoint-close);
		background: rgba(245, 158, 11, 0.05);
	}
	@keyframes goalAchieved {
		0% {
			transform: scale(1);
		}
		50% {
			transform: scale(1.02);
		}
		100% {
			transform: scale(1);
		}
	}
	.goal-indicator {
		width: 32px;
		height: 32px;
		border-radius: 50%;
		background: #f1f5f9;
		border: 2px solid #cbd5e1;
		display: flex;
		align-items: center;
		justify-content: center;
		flex-shrink: 0;
		transition: all 300ms cubic-bezier(0.34, 1.56, 0.64, 1);
		font-size: 16px;
		font-weight: 800;
	}
	.goal-item.achieved .goal-indicator {
		background: var(--checkpoint-unlocked);
		border-color: var(--checkpoint-unlocked);
		color: white;
		box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.2);
		animation: indicatorPop 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
	}
	.goal-item.close .goal-indicator {
		border-color: var(--checkpoint-close);
		background: rgba(245, 158, 11, 0.1);
	}
	@keyframes indicatorPop {
		0% {
			transform: scale(1) rotate(0deg);
		}
		50% {
			transform: scale(1.3) rotate(180deg);
		}
		100% {
			transform: scale(1) rotate(360deg);
		}
	}
	.goal-content {
		flex: 1;
	}
	.goal-amount {
		font-size: 16px;
		font-weight: 800;
		color: var(--text);
		margin-bottom: 2px;
	}
	.goal-item.achieved .goal-amount {
		color: #16a34a;
	}
	.goal-label {
		font-size: 13px;
		font-weight: 600;
		color: var(--muted);
	}
	.goal-item.achieved .goal-label {
		color: #15803d;
	}
	.badge {
		display: inline-flex;
		align-items: center;
		gap: 6px;
		font-size: 12px;
		font-weight: 800;
		padding: 6px 10px;
		border-radius: 999px;
		background: #eef2ff;
		color: #3730a3;
	}
	.badge .dot-mini {
		width: 8px; height: 8px; border-radius: 50%; background: #60a5fa;
	}
	.tabs {
		display: flex;
		gap: 8px;
		margin-bottom: 24px;
		border-bottom: 2px solid #e5e7eb;
	}
	.tab {
		padding: 12px 20px;
		background: transparent;
		border: none;
		border-bottom: 3px solid transparent;
		color: var(--muted);
		font-size: 14px;
		font-weight: 700;
		cursor: pointer;
		transition: all 150ms ease;
		font-family: 'Nunito', system-ui, sans-serif;
		position: relative;
		top: 2px;
	}
	.tab:hover {
		color: var(--text);
	}
	.tab.active {
		color: #0ea5e9;
		border-bottom-color: #0ea5e9;
	}
	.tab-content {
		display: none;
	}
	.tab-content.active {
		display: block;
	}
	.scoreboard-section {
		margin-top: 24px;
	}
	.scoreboard-list {
		display: flex;
		flex-direction: column;
		gap: 10px;
	}
	.scoreboard-item {
		display: flex;
		align-items: center;
		gap: 16px;
		padding: 16px;
		background: #fff;
		border: 2px solid #e5e7eb;
		border-radius: 12px;
		transition: all 200ms ease;
	}
	.scoreboard-item:hover {
		transform: translateY(-2px);
		box-shadow: 0 4px 12px rgba(0,0,0,0.1);
	}
	.scoreboard-item.rank-1 {
		background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 215, 0, 0.05));
		border-color: #ffd700;
	}
	.scoreboard-item.rank-2 {
		background: linear-gradient(135deg, rgba(192, 192, 192, 0.1), rgba(192, 192, 192, 0.05));
		border-color: #c0c0c0;
	}
	.scoreboard-item.rank-3 {
		background: linear-gradient(135deg, rgba(205, 127, 50, 0.1), rgba(205, 127, 50, 0.05));
		border-color: #cd7f32;
	}
	.rank-number {
		width: 40px;
		height: 40px;
		border-radius: 50%;
		background: #f1f5f9;
		border: 2px solid #cbd5e1;
		display: flex;
		align-items: center;
		justify-content: center;
		font-size: 18px;
		font-weight: 800;
		color: var(--text);
		flex-shrink: 0;
	}
	.scoreboard-item.rank-1 .rank-number {
		background: #ffd700;
		border-color: #ffd700;
		color: #fff;
		font-size: 20px;
	}
	.scoreboard-item.rank-2 .rank-number {
		background: #c0c0c0;
		border-color: #c0c0c0;
		color: #fff;
	}
	.scoreboard-item.rank-3 .rank-number {
		background: #cd7f32;
		border-color: #cd7f32;
		color: #fff;
	}
	.scoreboard-info {
		flex: 1;
	}
	.scoreboard-name {
		font-size: 18px;
		font-weight: 800;
		color: var(--text);
		margin-bottom: 4px;
	}
	.scoreboard-stats {
		font-size: 13px;
		color: var(--muted);
		font-weight: 600;
	}
	.scoreboard-amount {
		font-size: 24px;
		font-weight: 800;
		color: var(--text);
		min-width: 100px;
		text-align: right;
	}
	.scoreboard-item.rank-1 .scoreboard-amount {
		color: #ffd700;
	}
	.scoreboard-empty {
		text-align: center;
		padding: 48px;
		color: var(--muted);
		font-size: 14px;
	}
	.scoreboard-empty-icon {
		font-size: 48px;
		margin-bottom: 12px;
	}
</style>
</head>
<body>
	<div class="widget" role="region" aria-label="Invite Progress">
		<div class="header">
			<h1>Invite Tracker</h1>
			<span class="badge"><span class="dot-mini"></span> Play your way to perks</span>
		</div>

		<div class="tabs">
			<button class="tab active" data-tab="progress">Progress</button>
			<button class="tab" data-tab="scoreboard">Scoreboard</button>
		</div>

		<div id="progressTab" class="tab-content active">
			<div class="input-section">
			<div class="input-row">
				<div class="input-wrap" aria-live="polite">
					<label for="inviteInput">You've invited</label>
					<input id="inviteInput" type="number" min="0" step="1" value="0" inputmode="numeric" aria-describedby="progressHelp" />
				</div>
				<button id="submitBtn" class="submit-btn">Submit</button>
			</div>
			<div class="input-wrap">
				<label for="nameInput">Your name</label>
				<input id="nameInput" type="text" placeholder="Enter your name" maxlength="50" />
			</div>
		</div>

		<div class="progress-card">
			<div class="progress-bar" aria-hidden="true">
				<div id="progressFill" class="progress-fill"></div>
				<div class="checkpoints" id="checkpointsRow"></div>
			</div>
			<div class="progress-meta">
				<div class="current"><span id="currentCount">0</span> invites</div>
				<div class="max">Perk milestones up to 5000</div>
			</div>

			<div class="goals-list" id="goalsList"></div>
			<p id="progressHelp" style="margin:12px 0 0; color: var(--muted); font-size: 13px;">
				The bar fills as you invite more people. Milestones unlock as you pass them.
			</p>
		</div>

		<div class="history-section">
			<div class="history-header">
				<h2>Submission History</h2>
				<div class="history-actions">
					<button id="exportHistoryBtn" class="export-history-btn">Export</button>
					<button id="clearHistoryBtn" class="clear-history-btn">Clear</button>
				</div>
			</div>
			<div id="historyList" class="history-list">
				<div class="history-empty">
					<div class="history-empty-icon">üìù</div>
					<div>No submissions yet. Submit your invite count to start tracking!</div>
				</div>
			</div>
		</div>
		</div>

		<div id="scoreboardTab" class="tab-content">
			<div class="scoreboard-section">
				<h2 style="margin: 0 0 20px 0; font-size: 20px; font-weight: 800; color: var(--text);">Leaderboard</h2>
				<div id="scoreboardList" class="scoreboard-list">
					<div class="scoreboard-empty">
						<div class="scoreboard-empty-icon">üèÜ</div>
						<div>No submissions yet. Start inviting people to see the leaderboard!</div>
					</div>
				</div>
			</div>
		</div>
	</div>

<script>
	(function () {
		// Configuration
		const MAX_VISUAL = 5000; // visual cap for 100% width
		const CLOSE_DELTA = 200; // "close" visual boost radius
		const checkpoints = [
			{ value: 2000, label: '2000 Goal' },
			{ value: 2500, label: '2500 Pie Face Truman' },
			{ value: 3500, label: '3500 Pie Face Jack' },
			{ value: 5000, label: '5000 Frosted Tips Jack' }
		];

		// Elements
		const input = document.getElementById('inviteInput');
		const nameInput = document.getElementById('nameInput');
		const currentCountEl = document.getElementById('currentCount');
		const fill = document.getElementById('progressFill');
		const checkpointsRow = document.getElementById('checkpointsRow');
		const goalsList = document.getElementById('goalsList');
		const submitBtn = document.getElementById('submitBtn');
		const historyList = document.getElementById('historyList');
		const clearHistoryBtn = document.getElementById('clearHistoryBtn');
		const exportHistoryBtn = document.getElementById('exportHistoryBtn');
		const scoreboardList = document.getElementById('scoreboardList');
		const tabs = document.querySelectorAll('.tab');
		const tabContents = document.querySelectorAll('.tab-content');
		
		// Storage key
		const STORAGE_KEY = 'inviteWidgetHistory';
		let previousAchieved = new Set();

		// Render dots on progress bar
		function renderCheckpointDots() {
			checkpointsRow.innerHTML = '';
			checkpoints.forEach(cp => {
				const percent = Math.min(100, (cp.value / MAX_VISUAL) * 100);
				const dot = document.createElement('div');
				dot.className = 'checkpoint-dot';
				dot.style.left = percent + '%';
				dot.dataset.value = cp.value;
				checkpointsRow.appendChild(dot);
			});
		}

		// Render goals list
		function renderGoalsList() {
			goalsList.innerHTML = '';
			checkpoints.forEach(cp => {
				const goalItem = document.createElement('div');
				goalItem.className = 'goal-item';
				goalItem.dataset.value = cp.value;
				
				const indicator = document.createElement('div');
				indicator.className = 'goal-indicator';
				
				const content = document.createElement('div');
				content.className = 'goal-content';
				
				const amount = document.createElement('div');
				amount.className = 'goal-amount';
				amount.textContent = cp.value.toLocaleString();
				
				const label = document.createElement('div');
				label.className = 'goal-label';
				// Extract label text after the number (e.g., "2000 Goal" -> "Goal")
				const labelText = cp.label.replace(/^\d+\s+/, '');
				label.textContent = labelText || cp.label;
				
				content.appendChild(amount);
				content.appendChild(label);
				goalItem.appendChild(indicator);
				goalItem.appendChild(content);
				goalsList.appendChild(goalItem);
			});
		}

		renderCheckpointDots();
		renderGoalsList();

		// Tab switching functionality
		function switchTab(tabName) {
			tabs.forEach(tab => {
				if (tab.dataset.tab === tabName) {
					tab.classList.add('active');
				} else {
					tab.classList.remove('active');
				}
			});

			tabContents.forEach(content => {
				if (content.id === tabName + 'Tab') {
					content.classList.add('active');
				} else {
					content.classList.remove('active');
				}
			});

			// Update scoreboard when switching to it
			if (tabName === 'scoreboard') {
				renderScoreboard();
			}
		}

		// Calculate scores from history
		function calculateScores() {
			const history = getHistory();
			const scores = {};

			history.forEach(item => {
				const name = item.name || 'Anonymous';
				if (!scores[name]) {
					scores[name] = {
						name: name,
						total: 0,
						count: 0
					};
				}
				scores[name].total += item.amount;
				scores[name].count += 1;
			});

			// Convert to array and sort by total (descending)
			return Object.values(scores).sort((a, b) => b.total - a.total);
		}

		// Render scoreboard
		function renderScoreboard() {
			const scores = calculateScores();

			if (scores.length === 0) {
				scoreboardList.innerHTML = `
					<div class="scoreboard-empty">
						<div class="scoreboard-empty-icon">üèÜ</div>
						<div>No submissions yet. Start inviting people to see the leaderboard!</div>
					</div>
				`;
				return;
			}

			scoreboardList.innerHTML = scores.map((person, index) => {
				const rank = index + 1;
				const rankClass = rank <= 3 ? `rank-${rank}` : '';
				const submissionsText = person.count === 1 ? 'submission' : 'submissions';

				return `
					<div class="scoreboard-item ${rankClass}">
						<div class="rank-number">${rank}</div>
						<div class="scoreboard-info">
							<div class="scoreboard-name">${person.name}</div>
							<div class="scoreboard-stats">${person.count} ${submissionsText}</div>
						</div>
						<div class="scoreboard-amount">${person.total.toLocaleString()}</div>
					</div>
				`;
			}).join('');
		}

		// Get sum of all submissions from history
		function getTotalFromHistory() {
			const history = getHistory();
			if (history.length === 0) return 0;
			return history.reduce((sum, item) => sum + item.amount, 0);
		}

		function getUpcomingCheckpoint(value) {
			return checkpoints.find(cp => value < cp.value) || null;
		}

		function updateUI(value, skipAnimation = false) {
			const safeValue = Math.max(0, Number.isFinite(value) ? Math.floor(value) : 0);
			currentCountEl.textContent = safeValue.toLocaleString();

			// Progress fill
			const pct = Math.max(0, Math.min(100, (safeValue / MAX_VISUAL) * 100));
			if (skipAnimation) {
				fill.style.transition = 'none';
				fill.style.width = pct + '%';
				setTimeout(() => {
					fill.style.transition = '';
				}, 10);
			} else {
				fill.style.width = pct + '%';
			}

			// Bright boost when close to next checkpoint
			const next = getUpcomingCheckpoint(safeValue);
			if (next && (next.value - safeValue) <= CLOSE_DELTA) {
				fill.style.background = 'var(--fill-boost)';
			} else {
				fill.style.background = 'var(--fill)';
			}

			// Update checkpoint dots
			const dots = checkpointsRow.querySelectorAll('.checkpoint-dot');
			const currentAchieved = new Set();
			
			dots.forEach(dot => {
				const cpValue = Number(dot.dataset.value);
				const isAchieved = safeValue >= cpValue;
				const isClose = !isAchieved && (cpValue - safeValue) <= CLOSE_DELTA;
				const wasAchieved = dot.classList.contains('achieved');
				
				dot.classList.toggle('achieved', isAchieved);
				dot.classList.toggle('close', isClose);
				
				if (isAchieved) {
					currentAchieved.add(cpValue);
					// Trigger animation if just achieved
					if (!wasAchieved && !skipAnimation) {
						dot.style.animation = 'none';
						setTimeout(() => {
							dot.style.animation = '';
						}, 10);
					}
				}
			});

			// Update goals list
			const goalItems = goalsList.querySelectorAll('.goal-item');
			goalItems.forEach(item => {
				const cpValue = Number(item.dataset.value);
				const isAchieved = safeValue >= cpValue;
				const isClose = !isAchieved && (cpValue - safeValue) <= CLOSE_DELTA;
				const wasAchieved = previousAchieved.has(cpValue);
				
				item.classList.toggle('achieved', isAchieved);
				item.classList.toggle('close', isClose);
				
				const indicator = item.querySelector('.goal-indicator');
				if (isAchieved) {
					indicator.textContent = '‚úì';
					currentAchieved.add(cpValue);
					
					// Trigger animation if just achieved
					if (!wasAchieved && !skipAnimation) {
						indicator.style.animation = 'none';
						item.style.animation = 'none';
						setTimeout(() => {
							indicator.style.animation = '';
							item.style.animation = '';
						}, 10);
					}
				} else {
					indicator.textContent = '';
				}
			});

			previousAchieved = currentAchieved;
		}

		// Animate progress bar from 0 to target value
		function animateProgressBar(targetValue, duration = 2000) {
			const startValue = 0;
			const startTime = performance.now();
			
			function animate(currentTime) {
				const elapsed = currentTime - startTime;
				const progress = Math.min(elapsed / duration, 1);
				
				// Easing function for smooth animation
				const eased = 1 - Math.pow(1 - progress, 3); // Ease out cubic
				
				const currentValue = startValue + (targetValue - startValue) * eased;
				updateUI(currentValue, false);
				
				if (progress < 1) {
					requestAnimationFrame(animate);
				} else {
					// Ensure final value is exact
					updateUI(targetValue, false);
				}
			}
			
			// Start with 0
			updateUI(0, true);
			requestAnimationFrame(animate);
		}

		// Update progress based on history
		function updateProgressFromHistory() {
			const totalValue = getTotalFromHistory();
			// Slower animation - 3.5 seconds for smooth, visible progress
			animateProgressBar(totalValue, 3500);
		}

		// Storage functions
		function getHistory() {
			try {
				const stored = localStorage.getItem(STORAGE_KEY);
				return stored ? JSON.parse(stored) : [];
			} catch (e) {
				return [];
			}
		}

		function saveHistory(history) {
			try {
				localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
			} catch (e) {
				console.error('Failed to save history:', e);
			}
		}

		function formatDate(dateString) {
			const date = new Date(dateString);
			const now = new Date();
			const diffMs = now - date;
			const diffMins = Math.floor(diffMs / 60000);
			const diffHours = Math.floor(diffMs / 3600000);
			const diffDays = Math.floor(diffMs / 86400000);

			if (diffMins < 1) return 'Just now';
			if (diffMins < 60) return `${diffMins} minute${diffMins > 1 ? 's' : ''} ago`;
			if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
			if (diffDays < 7) return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;

			// Format full date
			return date.toLocaleDateString('en-US', {
				month: 'short',
				day: 'numeric',
				year: date.getFullYear() !== now.getFullYear() ? 'numeric' : undefined,
				hour: 'numeric',
				minute: '2-digit'
			});
		}

		function renderHistory() {
			const history = getHistory();
			
			if (history.length === 0) {
				historyList.innerHTML = `
					<div class="history-empty">
						<div class="history-empty-icon">üìù</div>
						<div>No submissions yet. Submit your invite count to start tracking!</div>
					</div>
				`;
				return;
			}

			// Sort by date (newest first)
			const sorted = [...history].sort((a, b) => new Date(b.date) - new Date(a.date));

			historyList.innerHTML = sorted.map((item, index) => {
				const itemId = item.date; // Use date as unique ID
				return `
					<div class="history-item">
						<div class="history-item-content">
							<div class="history-item-top">
								<span class="history-amount">${item.amount.toLocaleString()} invites</span>
								${item.name ? `<span class="history-name">by ${item.name}</span>` : ''}
							</div>
							<span class="history-date">${formatDate(item.date)}</span>
						</div>
						<button class="delete-item-btn" data-item-id="${itemId}" title="Delete this submission">√ó</button>
					</div>
				`;
			}).join('');

			// Attach delete handlers
			historyList.querySelectorAll('.delete-item-btn').forEach(btn => {
				btn.addEventListener('click', (e) => {
					const itemId = e.target.getAttribute('data-item-id');
					deleteHistoryItem(itemId);
				});
			});

			// Update scoreboard if we're on that tab
			const scoreboardTab = document.getElementById('scoreboardTab');
			if (scoreboardTab && scoreboardTab.classList.contains('active')) {
				renderScoreboard();
			}
		}

		function deleteHistoryItem(itemDate) {
			if (!confirm('Are you sure you want to delete this submission?')) {
				return;
			}

			const history = getHistory();
			const filtered = history.filter(item => item.date !== itemDate);
			saveHistory(filtered);
			renderHistory();
			
			// Update input to show new total (for reference)
			const newTotal = getTotalFromHistory();
			input.value = newTotal;
			
			// Update progress bar after deletion
			updateProgressFromHistory();
		}

		function submitInviteCount() {
			const value = Number(input.value);
			if (!Number.isFinite(value) || value < 0) {
				alert('Please enter a valid number');
				return;
			}

			const name = nameInput.value.trim() || 'Anonymous';

			const history = getHistory();
			const newEntry = {
				amount: Math.floor(value),
				name: name,
				date: new Date().toISOString()
			};

			history.push(newEntry);
			saveHistory(history);
			renderHistory();
			
			// Update input to show new total (for reference)
			const newTotal = getTotalFromHistory();
			input.value = newTotal;
			
			// Update progress bar after submission
			updateProgressFromHistory();

			// Success animation
			submitBtn.classList.add('submit-success');
			setTimeout(() => {
				submitBtn.classList.remove('submit-success');
			}, 500);
		}

		function clearHistory() {
			if (confirm('Are you sure you want to clear all submission history?')) {
				localStorage.removeItem(STORAGE_KEY);
				renderHistory();
				// Reset input field
				input.value = 0;
				// Reset progress bar
				updateProgressFromHistory();
			}
		}

		function exportHistory() {
			const history = getHistory();
			if (history.length === 0) {
				alert('No history to export');
				return;
			}

			// Create CSV content
			const headers = ['Date', 'Name', 'Amount', 'Formatted Date'];
			const rows = history.map(item => {
				const date = new Date(item.date);
				return [
					date.toISOString(),
					item.name || 'Anonymous',
					item.amount,
					formatDate(item.date)
				];
			});

			const csvContent = [
				headers.join(','),
				...rows.map(row => row.map(cell => `"${cell}"`).join(','))
			].join('\n');

			// Create and download file
			const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
			const link = document.createElement('a');
			const url = URL.createObjectURL(blob);
			link.setAttribute('href', url);
			link.setAttribute('download', `invite-history-${new Date().toISOString().split('T')[0]}.csv`);
			link.style.visibility = 'hidden';
			document.body.appendChild(link);
			link.click();
			document.body.removeChild(link);
		}

		// Wire up events
		const handleEnter = (e) => {
			if (e.key === 'Enter') {
				submitInviteCount();
			}
		};
		input.addEventListener('keypress', handleEnter);
		nameInput.addEventListener('keypress', handleEnter);
		submitBtn.addEventListener('click', submitInviteCount);
		clearHistoryBtn.addEventListener('click', clearHistory);
		exportHistoryBtn.addEventListener('click', exportHistory);
		
		// Tab switching
		tabs.forEach(tab => {
			tab.addEventListener('click', () => {
				switchTab(tab.dataset.tab);
			});
		});

		// Initial paint
		renderHistory();
		
		// Set input to show current total from history (for reference only)
		const totalValue = getTotalFromHistory();
		input.value = totalValue;
		
		// Animate progress bar on page load
		setTimeout(() => {
			updateProgressFromHistory();
		}, 300); // Small delay to ensure DOM is ready
	})();
</script>
</body>
</html>

